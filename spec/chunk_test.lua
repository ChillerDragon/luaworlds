local chunks = require("src/chunks")


local c1 = {
	header = {
		flags = {
			vital = true,
			resend = false
		},
		size = 2,
		seq = 1
	},
	data = string.char(0xff, 0xff)
}
assert(chunks.pack(c1) == string.char(0x40, 0x02, 0x01, 0xFF, 0xFF))

assert(#chunks.get_all_chunks(string.char(0x00)) == 0)

assert(chunks.unpack_header(string.char(0x40, 0x01, 0x01)).flags.vital == true)
assert(chunks.unpack_header(string.char(0x40, 0x01, 0x01)).flags.resend == false)
assert(chunks.unpack_header(string.char(0x40, 0x01, 0x01)).size == 1)
assert(chunks.unpack_header(string.char(0x40, 0x01, 0x01)).seq == 1)

assert(chunks.unpack_header(string.char(0x40, 0x03, 0x01)).size == 3)

-- game.sv_vote_clear_options, game.sv_tune_params, game.sv_ready_to_enter
local msg = string.char(
	0x40, 0x01, 0x05, 0x16, 0x41, 0x05, 0x06, 0x0c, 0xa8, 0x0f, 0x88, 0x03, 0x32, 0xa8, 0x14,
	0xb0, 0x12, 0xb4, 0x07, 0x96, 0x02, 0x9f, 0x01, 0xb0, 0xd1, 0x04, 0x80, 0x7d, 0xac, 0x04, 0x9c,
	0x17, 0x32, 0x98, 0xdb, 0x06, 0x80, 0xb5, 0x18, 0x8c, 0x02, 0xbd, 0x01, 0xa0, 0xed, 0x1a, 0x88,
	0x03, 0xbd, 0x01, 0xb8, 0xc8, 0x21, 0x90, 0x01, 0x14, 0xbc, 0x0a, 0xa0, 0x9a, 0x0c, 0x88, 0x03,
	0x80, 0xe2, 0x09, 0x98, 0xea, 0x01, 0xa4, 0x01, 0x00, 0xa4, 0x01, 0xa4, 0x01, 0x40, 0x01, 0x07,
	0x10
)
assert(#chunks.get_all_chunks(msg) == 3)

